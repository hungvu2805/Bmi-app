<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>App T√≠nh BMI, TDEE, Macro</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #ffe6f0;
      max-width: 480px;
      margin: auto;
      padding: 20px;
      color: #333;
    }
    h2 {
      text-align: center;
      color: #d63384;
    }
    label, input, select, button {
      display: block;
      width: 100%;
      margin-top: 10px;
      font-size: 16px;
    }
    button {
      background-color: #d63384;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background-color: #b82d6b;
    }
    .result, .history {
      background: #fff;
      padding: 15px;
      border-left: 4px solid #d63384;
      margin-top: 20px;
      border-radius: 6px;
    }
    .zalo {
      margin-top: 15px;
      text-align: center;
    }
    .zalo a {
      background: #00a1d6;
      color: white;
      padding: 10px 20px;
      display: inline-block;
      border-radius: 6px;
      text-decoration: none;
    }
    .popup {
      display: none;
      position: fixed;
      top: 5%;
      left: 5%;
      width: 90%;
      max-height: 90%;
      overflow-y: auto;
      background: white;
      border: 2px solid #d63384;
      border-radius: 8px;
      padding: 15px;
      z-index: 1000;
    }
    .popup h3 {
      color: #d63384;
    }
    .popup button {
      margin-top: 10px;
      background-color: #888;
    }
  </style>
</head>
<body>

<h2>üíñ T√≠nh BMI ‚Äì TDEE ‚Äì G·ª£i √Ω Dinh d∆∞·ª°ng üíñ</h2>

<label>üë§ T√™n c·ªßa b·∫°n (tu·ª≥ ch·ªçn):</label>
<input type="text" id="name">

<label>üìè C√¢n n·∫∑ng (kg):</label>
<input type="number" id="weight" step="0.1" required>

<label>üìê Chi·ªÅu cao (cm):</label>
<input type="number" id="height" required>

<label>üî• M·ª©c ƒë·ªô ho·∫°t ƒë·ªông (PAL):</label>
<select id="pal">
  <option value="1.2">1.2 ‚Äì √çt v·∫≠n ƒë·ªông</option>
  <option value="1.55">1.55 ‚Äì V·∫≠n ƒë·ªông v·ª´a</option>
  <option value="1.75">1.75 ‚Äì T·∫≠p luy·ªán cao</option>
</select>

<label>üéØ M·ª•c ti√™u:</label>
<select id="goal">
  <option value="giam">Gi·∫£m m·ª°</option>
  <option value="co">SƒÉn ch·∫Øc</option>
</select>

<button onclick="tinh()">üí• T√≠nh ngay</button>

<div id="output" class="result" style="display:none;"></div>

<div class="zalo">
  üì© C·∫ßn t∆∞ v·∫•n ri√™ng? <br>
  <a href="https://zalo.me/0981781056" target="_blank">G·ª≠i k·∫øt qu·∫£ qua Zalo</a>
</div>

<div id="popup" class="popup">
  <div id="popupContent"></div>
  <button onclick="closePopup()">ƒê√≥ng</button>
</div>

<div id="history" class="history" style="display:none;">
  <h3>L·ªãch s·ª≠ tra c·ª©u:</h3>
  <ul id="historyList"></ul>
  <button onclick="clearHistory()">üóë Xo√° l·ªãch s·ª≠</button>
</div>

<script>
function tinh() {
  let name = document.getElementById("name").value.trim();
  let weight = parseFloat(document.getElementById('weight').value);
  let height = parseFloat(document.getElementById('height').value);
  let pal = parseFloat(document.getElementById('pal').value);
  let goal = document.getElementById('goal').value;

  if (!weight || !height) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß.");

  let heightM = height / 100;
  let bmi = weight / (heightM * heightM);
  let status = bmi < 18.5 ? "Thi·∫øu c√¢n" :
               bmi <= 22.9 ? "Trung b√¨nh" :
               bmi <= 24.9 ? "Th·ª´a c√¢n" :
               bmi <= 29.9 ? "B√©o ph√¨ ƒë·ªô I" : "B√©o ph√¨ ƒë·ªô II";
  let ideal = (height - 100) * 0.9;
  let bmr = weight * 22;
  let tdee = bmr * pal;
  let defPercent = bmi <= 22.9 ? 0.10 : bmi <= 24.9 ? 0.25 : 0.35;
  let der = Math.round(tdee - tdee * defPercent);
  let thieuMoiNgay = Math.round(tdee - der);
  let giamThang = (thieuMoiNgay * 30 / 7700).toFixed(1); // 7700kcal = 1kg m·ª°

  let protein = 120;
  let pCalo = protein * 4;
  let cCalo = goal === "co" ? der * 0.4 : der * 0.2;
  let fCalo = der - pCalo - cCalo;

  let output = `
    <strong>BMI:</strong> ${bmi.toFixed(1)} (${status})<br>
    <strong>C√¢n n·∫∑ng l√Ω t∆∞·ªüng:</strong> ${ideal.toFixed(1)} kg<br>
    <strong>BMR:</strong> ${Math.round(bmr)} cal<br>
    <strong>TDEE:</strong> ${Math.round(tdee)} cal<br>
    <strong>DER (calo m·ª•c ti√™u):</strong> ${der} cal<br>
    <strong>∆Ø·ªõc t√≠nh gi·∫£m m·ªói th√°ng:</strong> ${giamThang} kg<br>
    <strong>Macro:</strong><br>
    ‚Ä¢ Protein: ${protein}g (${pCalo} cal)<br>
    ‚Ä¢ Carb: ${Math.round(cCalo/4)}g (${Math.round(cCalo)} cal)<br>
    ‚Ä¢ Fat: ${Math.round(fCalo/9)}g (${Math.round(fCalo)} cal)<br>
  `;

  document.getElementById("output").innerHTML = output;
  document.getElementById("output").style.display = "block";

  showPopup(der);

  if (name) saveHistory(name, bmi.toFixed(1), der);
  loadHistory();
}

function showPopup(der) {
  const content = `
    <h3>üìÖ L·ªãch t·∫≠p 7 ng√†y (4 fullbody + 3 metcon):</h3>
    <ul>
      <li>Th·ª© 2: Goblet squat, Incline push up, Wall sit</li>
      <li>Th·ª© 3: Metcon ‚Äì Inch Worm, Slam, Side plank</li>
      <li>Th·ª© 4: Romanian DL, Lat Pulldown, Face Pull</li>
      <li>Th·ª© 5: Metcon ‚Äì Inch Worm, Farmer Walk, Plank</li>
      <li>Th·ª© 6: DB Split squat, DB Bench, Lateral Raise</li>
      <li>Th·ª© 7: Metcon ‚Äì Squat Press, Battle Rope</li>
      <li>CN: Ngh·ªâ / thi·ªÅn</li>
    </ul>
    <h3>üçΩ Th·ª±c ƒë∆°n ~1400 calo:</h3>
    <ul>
      <li><strong>S√°ng:</strong> Khoai lang 135g, 3 tr·ª©ng lu·ªôc, X√† l√°ch 200g</li>
      <li><strong>Tr∆∞a:</strong> C∆°m 100g, Th·ªãt heo 200g, B·∫Øp c·∫£i 200g</li>
      <li><strong>T·ªëi:</strong> C∆°m 100g, Th·ªãt b√≤ 200g, Rau c·∫£i 200g</li>
    </ul>
    üëâ Mu·ªën l·ªãch t·∫≠p t·∫°i nh√† kh√¥ng c·∫ßn t·∫°? <a href="https://zalo.me/0981781056" target="_blank">ib Coach H∆∞ng</a>
  `;
  document.getElementById("popupContent").innerHTML = content;
  document.getElementById("popup").style.display = "block";
}

function closePopup() {
  document.getElementById("popup").style.display = "none";
}

function saveHistory(name, bmi, der) {
  let list = JSON.parse(localStorage.getItem("bmiHistory") || "[]");
  list.push({ name, bmi, der });
  localStorage.setItem("bmiHistory", JSON.stringify(list));
}

function loadHistory() {
  let list = JSON.parse(localStorage.getItem("bmiHistory") || "[]");
  let ul = document.getElementById("historyList");
  ul.innerHTML = "";
  if (list.length === 0) {
    document.getElementById("history").style.display = "none";
    return;
  }
  list.forEach(i => {
    let li = document.createElement("li");
    li.textContent = `${i.name}: BMI ${i.bmi}, DER ${i.der} cal`;
    ul.appendChild(li);
  });
  document.getElementById("history").style.display = "block";
}

function clearHistory() {
  localStorage.removeItem("bmiHistory");
  loadHistory();
}
</script>

</body>
</html>
